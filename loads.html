<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RC Design | Load Calculations</title>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <!-- MathJax for LaTeX -->
    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* Visualization Canvas */
        #beamCanvas {
            width: 100%;
            height: 250px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }

        /* Alerts & Summaries */
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            border-left: 4px solid;
            display: none; /* Hidden by default */
        }

        .alert-error {
            background: #fef2f2;
            color: #991b1b;
            border-color: var(--error);
        }

        .alert-warning {
            background: #fffbeb;
            color: #92400e;
            border-color: var(--warning);
        }

        .summary-box {
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .summary-step {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px dashed #cbd5e1;
        }

        .summary-step:last-child {
            border-bottom: none;
        }

        .result-value {
            font-weight: 700;
            color: var(--accent);
        }
    </style>
</head>
<body>

    <!-- SIDEBAR -->
    <nav class="sidebar">
        <a href="index.html" class="back-btn">
            <i class="fa-solid fa-arrow-left"></i> Dashboard
        </a>

        <div class="input-panel">
            <h2 class="panel-title">Load Parameters</h2>
            <form id="loadForm" onsubmit="event.preventDefault(); calculateLoads();">
                <div class="section-header">Beam Geometry</div>
                <div class="form-row">
                    <div class="form-col">
                        <label class="form-label">Span $L$ (m)</label>
                        <input type="number" id="span" class="form-control" value="6.0" step="0.1" required>
                    </div>
                    <div class="form-col">
                        <label class="form-label">Width $b_w$ (mm)</label>
                        <input type="number" id="width" class="form-control" value="300" step="10" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Height $h$ (mm)</label>
                    <input type="number" id="height" class="form-control" value="450" step="10" required>
                </div>

                <div class="section-header">Material Properties</div>
                <div class="form-row">
                    <div class="form-col">
                        <label class="form-label">Density (kN/m³)</label>
                        <input type="number" id="density" class="form-control" value="24.0" step="0.1" required>
                    </div>
                    <div class="form-col">
                        <label class="form-label">Concrete $f'_c$</label>
                        <input type="number" id="fc" class="form-control" value="28" step="1" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Steel $f_y$ (MPa)</label>
                    <input type="number" id="fy" class="form-control" value="420" step="10" required>
                </div>

                <div class="section-header">Applied Loads</div>
                <div class="form-row">
                    <div class="form-col">
                        <label class="form-label">SDL (kN/m)</label>
                        <input type="number" id="wd_super" class="form-control" value="10.0" step="0.1">
                    </div>
                    <div class="form-col">
                        <label class="form-label">Live (kN/m)</label>
                        <input type="number" id="wl" class="form-control" value="15.0" step="0.1">
                    </div>
                </div>

                <button type="submit" class="btn-calc">Calculate Loads & Checks</button>
            </form>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <!-- Hero Section -->
        <div class="hero">
            <h1>Load Analysis & Preliminary Check</h1>
            <p>Calculate factored loads (SI) and verify geometric feasibility for reinforced concrete beams.</p>
        </div>

        <div class="calc-grid">
            <!-- Results & Visualization -->
            <div class="output-section">
                
                <!-- Alerts Container -->
                <div id="alertBox" class="alert"></div>

                <!-- Visualization -->
                <div class="card">
                    <h3 style="margin-bottom: 1rem;">Load Visualization</h3>
                    <canvas id="beamCanvas"></canvas>
                    <div style="text-align: center; margin-top: 10px; font-size: 0.85rem; color: var(--text-muted);">
                        Diagram represents Uniformly Distributed Loads (Factored)
                    </div>
                </div>

                <!-- Detailed Results -->
                <div class="card" id="resultsPanel" style="display:none;">
                    <div class="panel-title">Calculation Summary</div>
                    <div class="summary-box">
                        
                        <!-- Step 1: Self Weight -->
                        <div class="summary-step">
                            <div id="res_step1"></div>
                        </div>

                        <!-- Step 2: Unfactored Loads -->
                        <div class="summary-step">
                            <div id="res_step2"></div>
                        </div>

                        <!-- Step 3: Factored Loads -->
                        <div class="summary-step">
                            <div id="res_step3"></div>
                        </div>

                        <!-- Step 4: Forces -->
                        <div class="summary-step">
                            <div id="res_step4"></div>
                        </div>

                        <!-- Step 5: Feasibility Check -->
                        <div class="summary-step">
                            <strong>5. Geometry & Bar Fit Check</strong><br>
                            <div id="checkResultContent"></div>
                        </div>

                    </div>
                </div>

            </div>
        </div>
    </main>

    <script>
        // Initialize Canvas
        const canvas = document.getElementById('beamCanvas');
        const ctx = canvas.getContext('2d');

        // Draw initial blank state
        drawVisualization(6, 45, 'Waiting for input...');

        function calculateLoads() {
            // 1. Get Inputs
            const L = parseFloat(document.getElementById('span').value);
            const b_mm = parseFloat(document.getElementById('width').value);
            const h_mm = parseFloat(document.getElementById('height').value);
            const gamma = parseFloat(document.getElementById('density').value);
            const fc = parseFloat(document.getElementById('fc').value);
            const fy = parseFloat(document.getElementById('fy').value);
            const w_sdl = parseFloat(document.getElementById('wd_super').value);
            const w_l = parseFloat(document.getElementById('wl').value);

            // 2. Sanity Checks
            const alertBox = document.getElementById('alertBox');
            alertBox.style.display = 'none';
            alertBox.className = 'alert';

            if (L <= 0 || b_mm <= 0 || h_mm <= 0) {
                showAlert('Error: Dimensions must be positive values.', 'error');
                return;
            }

            // Aspect Ratio Check
            const aspectRatio = h_mm / b_mm;
            let warningMsg = "";
            
            if (b_mm < 200) {
                warningMsg += `Warning: Beam width (${b_mm}mm) is very narrow for structural concrete. Standard minimum is often 200-250mm.<br>`;
            }
            if (aspectRatio > 4) {
                warningMsg += `Warning: Deep beam detected ($h/b > 4$). Standard beam theory might not apply.<br>`;
            } else if (aspectRatio < 0.5) {
                warningMsg += `Warning: Beam is very shallow ($h/b < 0.5$). Deflection might be an issue.<br>`;
            }

            if (warningMsg !== "") {
                showAlert(warningMsg, 'warning');
            }

            // 3. Calculations
            // Convert to meters
            const b_m = b_mm / 1000;
            const h_m = h_mm / 1000;

            // Self weight (kN/m)
            const w_sw = b_m * h_m * gamma;
            
            // Total Dead
            const w_d = w_sw + w_sdl;

            // Factored Load (1.2D + 1.6L)
            const w_u = (1.2 * w_d) + (1.6 * w_l);

            // Forces
            const m_u = (w_u * Math.pow(L, 2)) / 8;
            const v_u = (w_u * L) / 2;

            // 4. Bar Fitting Feasibility Check (Approximate)
            // Estimate required steel area assuming a standard under-reinforced section
            // Approximation: As ~ Mu / (0.9 * fy * 0.9d)
            // d approx h - 60mm
            const d_est = h_mm - 60;
            const phi = 0.9;
            const lever_arm_ratio = 0.9;
            
            // Mu in N-mm for steel calc
            const m_u_Nmm = m_u * 1000000;
            
            const As_req_approx = m_u_Nmm / (phi * fy * lever_arm_ratio * d_est);
            
            // Assume 20mm (#6 equivalent) bars for fitting check
            const bar_dia = 20; 
            const bar_area = 314; // mm^2
            const num_bars = Math.ceil(As_req_approx / bar_area);
            
            // Required width check: 2 * cover + 2 * stirrup + num_bars * dia + (num_bars-1) * spacing
            // Approx: 40mm cover, 10mm stirrup, 25mm spacing
            const min_clear_spacing = Math.max(bar_dia, 25);
            const req_width_approx = (2 * 40) + (2 * 10) + (num_bars * bar_dia) + ((num_bars - 1) * min_clear_spacing);
            
            let fitStatusHTML = "";
            
            if (req_width_approx > b_mm) {
                fitStatusHTML = `<span style="color:var(--danger)"><i class="fa-solid fa-triangle-exclamation"></i> <strong>Capacity/Fitting Warning:</strong></span><br>
                Based on the load, you need approx. <strong>${(As_req_approx).toFixed(0)} mm²</strong> of steel.<br>
                Using 20mm bars, this requires roughly <strong>${num_bars} bars</strong>.<br>
                Estimated required width for one layer: <strong>${req_width_approx} mm</strong>.<br>
                Current width: <strong>${b_mm} mm</strong>. Bars may not fit in one layer. Consider increasing width or depth.`;
            } else {
                fitStatusHTML = `<span style="color:var(--success)"><i class="fa-solid fa-check-circle"></i> <strong>Feasible Geometry:</strong></span><br>
                Estimated steel area required: <strong>${(As_req_approx).toFixed(0)} mm²</strong> (approx ${num_bars} x 20mm bars).<br>
                These should fit comfortably within the ${b_mm} mm width in a single layer.`;
            }

            // 5. Update UI
            document.getElementById('resultsPanel').style.display = 'block';

            // Fill spans
            document.getElementById('res_step1').innerHTML = `
                <strong>1. Self-Weight Calculation</strong><br>
                Convert dimensions to meters:<br>
                $$ b_w = ${b_m.toFixed(3)} \\, \\text{m}, \\quad h = ${h_m.toFixed(3)} \\, \\text{m} $$
                Calculate self-weight ($w_{sw}$):
                $$ w_{sw} = b_w \\times h \\times \\gamma_c $$
                $$ w_{sw} = ${b_m.toFixed(2)} \\times ${h_m.toFixed(2)} \\times ${gamma} = \\mathbf{${w_sw.toFixed(2)}} \\, \\text{kN/m} $$
            `;

            document.getElementById('res_step2').innerHTML = `
                <strong>2. Total Dead Load ($D$)</strong><br>
                $$ w_D = w_{sw} + w_{SDL} = ${w_sw.toFixed(2)} + ${w_sdl.toFixed(2)} = \\mathbf{${w_d.toFixed(2)}} \\, \\text{kN/m} $$
            `;

            document.getElementById('res_step3').innerHTML = `
                <strong>3. Factored Design Load ($w_u$)</strong><br>
                Using ACI 318 Factors ($1.2D + 1.6L$):
                $$ w_u = 1.2(w_D) + 1.6(w_L) $$
                $$ w_u = 1.2(${w_d.toFixed(2)}) + 1.6(${w_l.toFixed(2)}) $$
                $$ w_u = \\mathbf{${w_u.toFixed(2)}} \\, \\text{kN/m} $$
            `;

            document.getElementById('res_step4').innerHTML = `
                <strong>4. Design Forces (Simple Span)</strong><br>
                Ultimate Moment ($M_u$):
                $$ M_u = \\frac{w_u L^2}{8} = \\frac{${w_u.toFixed(2)} \\times ${L}^2}{8} = \\mathbf{${m_u.toFixed(2)}} \\, \\text{kN}\\cdot\\text{m} $$
                Ultimate Shear ($V_u$):
                $$ V_u = \\frac{w_u L}{2} = \\mathbf{${v_u.toFixed(2)}} \\, \\text{kN} $$
            `;

            document.getElementById('checkResultContent').innerHTML = `
                ${fitStatusHTML}
                <h4 style="margin-top: 1rem; margin-bottom: 0.5rem;">Reinforcement Schedule (Estimated)</h4>
                <table style="width:100%; border-collapse:collapse; font-size:0.9rem;">
                    <tr style="border-bottom:1px solid #eee;"><td style="padding:5px; font-weight:600;">Estimated $A_s$ Req.</td><td style="padding:5px;">${As_req_approx.toFixed(0)} mm²</td></tr>
                    <tr style="border-bottom:1px solid #eee;"><td style="padding:5px; font-weight:600;">Assumed Bar Size</td><td style="padding:5px;">20 mm</td></tr>
                    <tr style="border-bottom:1px solid #eee;"><td style="padding:5px; font-weight:600;">Estimated Qty</td><td style="padding:5px;">${num_bars} bars</td></tr>
                    <tr style="border-bottom:1px solid #eee;"><td style="padding:5px; font-weight:600;">Min. Width Req.</td><td style="padding:5px;">${req_width_approx.toFixed(0)} mm</td></tr>
                </table>
            `;

            // Re-render MathJax
            MathJax.typesetPromise();

            // Draw Visualization
            drawVisualization(L, w_u, null);
        }

        function showAlert(msg, type) {
            const box = document.getElementById('alertBox');
            box.style.display = 'block';
            box.innerHTML = msg;
            if (type === 'error') {
                box.className = 'alert alert-error';
            } else {
                box.className = 'alert alert-warning';
            }
        }

        // Canvas Drawing Logic
        function drawVisualization(L, loadVal, msg) {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const w = canvas.width;
            const h = canvas.height;

            if (msg) {
                ctx.fillStyle = "#64748b";
                ctx.font = "16px Inter";
                ctx.textAlign = "center";
                ctx.fillText(msg, w/2, h/2);
                return;
            }

            // Margins
            const mx = 50;
            const my = 100;
            
            // Scale
            const drawL = w - (2 * mx);
            const beamY = h / 2 + 20;
            const beamH = 20;

            // Draw Beam
            ctx.fillStyle = "#e2e8f0";
            ctx.strokeStyle = "#475569";
            ctx.lineWidth = 2;
            ctx.fillRect(mx, beamY, drawL, beamH);
            ctx.strokeRect(mx, beamY, drawL, beamH);

            // Draw Supports
            drawSupport(mx, beamY + beamH, 'pin');
            drawSupport(mx + drawL, beamY + beamH, 'roller');

            // Draw Distributed Load
            const arrowSpacing = 20;
            const arrowHeight = 40;
            const loadY = beamY; // Bottom of arrow touches top of beam
            
            ctx.strokeStyle = "#ef4444";
            ctx.fillStyle = "#ef4444";
            
            // Load Line
            ctx.beginPath();
            ctx.moveTo(mx, loadY - arrowHeight);
            ctx.lineTo(mx + drawL, loadY - arrowHeight);
            ctx.stroke();

            // Arrows
            for (let x = mx; x <= mx + drawL; x += arrowSpacing) {
                drawArrow(x, loadY - arrowHeight, x, loadY);
            }

            // Labels
            ctx.fillStyle = "#0f172a";
            ctx.textAlign = "center";
            ctx.font = "bold 14px Inter";
            ctx.fillText(`wu = ${loadVal.toFixed(2)} kN/m`, w/2, loadY - arrowHeight - 10);
            
            ctx.fillStyle = "#64748b";
            ctx.fillText(`L = ${L} m`, w/2, beamY + beamH + 40);
        }

        function drawSupport(x, y, type) {
            ctx.beginPath();
            ctx.strokeStyle = "#0f172a";
            ctx.lineWidth = 2;
            
            // Triangle
            ctx.moveTo(x, y);
            ctx.lineTo(x - 10, y + 15);
            ctx.lineTo(x + 10, y + 15);
            ctx.closePath();
            ctx.stroke();

            if (type === 'roller') {
                // Draw wheels
                ctx.beginPath();
                ctx.arc(x - 5, y + 18, 3, 0, 2 * Math.PI);
                ctx.stroke();
                ctx.beginPath();
                ctx.arc(x + 5, y + 18, 3, 0, 2 * Math.PI);
                ctx.stroke();
                // Ground line
                ctx.beginPath();
                ctx.moveTo(x - 15, y + 21);
                ctx.lineTo(x + 15, y + 21);
                ctx.stroke();
            } else {
                // Ground line
                ctx.beginPath();
                ctx.moveTo(x - 15, y + 15);
                ctx.lineTo(x + 15, y + 15);
                ctx.stroke();
                // Hatching
                for(let i = -15; i < 15; i+=5) {
                    ctx.moveTo(x + i, y + 15);
                    ctx.lineTo(x + i - 3, y + 20);
                }
                ctx.stroke();
            }
        }

        function drawArrow(fromx, fromy, tox, toy) {
            const headlen = 8; // length of head in pixels
            const angle = Math.atan2(toy - fromy, tox - fromx);
            
            ctx.beginPath();
            ctx.moveTo(fromx, fromy);
            ctx.lineTo(tox, toy);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(tox, toy);
            ctx.lineTo(tox - headlen * Math.cos(angle - Math.PI / 6), toy - headlen * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(tox - headlen * Math.cos(angle + Math.PI / 6), toy - headlen * Math.sin(angle + Math.PI / 6));
            ctx.fill();
        }

        // Initialize
        window.onload = function() {
            // Attach listeners to all inputs for live update
            document.querySelectorAll('.input-panel input, .input-panel select').forEach(el => {
                el.addEventListener('input', calculateLoads);
            });
        };
    </script>
</body>
</html>