<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Development Length Calculator (SI) | RC Design Suite</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <!-- MathJax for LaTeX -->
    <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        .visualization-container {
            display: flex;
            justify-content: center;
            background: #f8fafc;
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid #e2e8f0;
        }

        .status-box {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }
        .status-ok { background-color: #dcfce7; color: #166534; border: 1px solid #86efac; }
        .status-err { background-color: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; }

        .result-equation {
            font-size: 1.1rem;
            margin: 1.5rem 0;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 8px;
            overflow-x: auto;
        }
        /* Visualization SVG */
        svg { width: 100%; height: auto; max-width: 600px; }
        .bar-fill { fill: #334155; }
        .concrete-fill { fill: #e2e8f0; stroke: #94a3b8; stroke-width: 2; }
        .dim-line { stroke: #ef4444; stroke-width: 1.5; marker-end: url(#arrowhead); marker-start: url(#arrowhead); }
        .dim-text { fill: #ef4444; font-size: 14px; font-weight: bold; }

    </style>
</head>
<body>

    <!-- SIDEBAR -->
    <nav class="sidebar">
        <a href="index.html" class="back-btn">
            <i class="fa-solid fa-arrow-left"></i> Dashboard
        </a>

        <div class="input-panel">
            <h2 class="panel-title">Development Length</h2>

        <form id="devForm">
            <!-- Material Properties -->
            <div class="section-header">Material Properties</div>
            <div class="form-row">
                <div class="form-col">
                    <label title="Concrete Compressive Strength">Concrete $f'_c$ (MPa)</label>
                    <input type="number" id="fc" value="28" min="10" step="1">
                </div>
                <div class="form-col">
                    <label title="Steel Yield Strength">Steel $f_y$ (MPa)</label>
                    <input type="number" id="fy" value="420" min="200" step="10">
                </div>
            </div>
            <div class="form-group">
                <label title="Concrete Type">Concrete Type</label>
                <select id="concreteType">
                    <option value="1.0">Normal Weight</option>
                    <option value="0.75">Lightweight</option>
                </select>
            </div>

            <!-- Reinforcement Details -->
            <div class="section-header">Reinforcement</div>
            <div class="form-row">
                <div class="form-col">
                    <label title="Bar Size (Metric)">Bar Size</label>
                    <select id="barSize">
                        <option value="10">10 mm</option>
                        <option value="13">13 mm</option>
                        <option value="16">16 mm</option>
                        <option value="19">19 mm</option>
                        <option value="22">22 mm</option>
                        <option value="25" selected>25 mm</option>
                        <option value="29">29 mm</option>
                        <option value="32">32 mm</option>
                        <option value="36">36 mm</option>
                        <option value="43">43 mm</option>
                        <option value="57">57 mm</option>
                    </select>
                </div>
                <div class="form-col">
                    <label title="Number of Bars in Layer">No. of Bars</label>
                    <input type="number" id="numBars" value="3" min="1" max="20">
                </div>
            </div>
            <div class="form-row">
                <div class="form-col">
                    <label title="Bar Coating">Coating</label>
                    <select id="coating">
                        <option value="1.0">Uncoated</option>
                        <option value="1.5">Epoxy (Cover < 3db)</option>
                        <option value="1.2">Epoxy (Other)</option>
                    </select>
                </div>
                <div class="form-col">
                    <label title="Top Bar Location">Location</label>
                    <select id="location">
                        <option value="1.0">Bottom / Vertical</option>
                        <option value="1.3">Top Bars</option>
                    </select>
                </div>
            </div>

            <!-- Geometry -->
            <div class="section-header">Section Geometry</div>
            <div class="form-row">
                <div class="form-col">
                    <label title="Beam/Element Width">Width $b$ (mm)</label>
                    <input type="number" id="width" value="300" min="100" step="10">
                </div>
                <div class="form-col">
                    <label title="Clear Cover to Bar">Clear Cover (mm)</label>
                    <input type="number" id="cover" value="40" min="10" step="5">
                </div>
            </div>
            <div class="form-group">
                <label title="Transverse Reinforcement Index">Transverse Index $K_{tr}$ (mm)</label>
                <input type="number" id="ktr" value="0" min="0" title="Usually taken as 0 for simplification">
            </div>

            <button type="button" class="calc-btn" onclick="calculate()">
                <i class="fa-solid fa-calculator"></i> Calculate Length
            </button>
        </form>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="results-panel">
        <!-- Hero Section -->
        <div class="hero">
            <h1>Development Length</h1>
            <p>Calculate required tension development length ($\ell_d$) for straight bars based on ACI 318M-11.</p>
        </div>

        <!-- Status / Sanity Check -->
        <div id="sanityCheck" class="status-box status-ok" style="display:none;">
            <i class="fa-solid fa-check-circle"></i> <span>Configuration is valid.</span>
        </div>

        <!-- Calculation Summary -->
        <div class="card">
            <h3>Tension Development Length Calculation</h3>
            <p>Based on <strong>ACI 318M-11 (Section 12.2)</strong> / McCormac & Brown Chapter 7 (SI Units).</p>
            
            <div class="result-equation">
                $$ \ell_d = \frac{9}{10} \frac{f_y}{\lambda \sqrt{f'_c}} \frac{\psi_t \psi_e \psi_s}{\left(\frac{c_b + K_{tr}}{d_b}\right)} d_b $$
            </div>

            <div id="detailedSummary"></div>

            <div style="background-color: #f0f9ff; padding: 1rem; border-left: 4px solid #3b82f6; border-radius: 4px;">
                <span style="font-size: 1.2rem; font-weight: bold; color: var(--text-main);">Required $\ell_d$: </span>
                <span id="finalResult" style="font-size: 1.5rem; font-weight: bold; color: #2563eb;">-- mm</span>
            </div>
        </div>

        <!-- Visualizations -->
        <div class="card">
            <h3>Visualizations</h3>
            <div class="visualization-container" id="vizContainer">
                <!-- SVG injected via JS -->
                <p style="color: #64748b;">Enter parameters to generate diagrams.</p>
            </div>
        </div>

        <!-- Reinforcement Summary Table -->
        <div class="card">
            <h3>Reinforcement Summary</h3>
            <div id="reinforcementSchedule"></div>
        </div>

    </main>

    <!-- SCRIPT -->
    <script>
        // Metric Bar Data (Area in mm^2, Dia in mm)
        const barData = {
            10: { d: 9.5, a: 71 },
            13: { d: 12.7, a: 129 },
            16: { d: 15.9, a: 199 },
            19: { d: 19.1, a: 284 },
            22: { d: 22.2, a: 387 },
            25: { d: 25.4, a: 510 },
            29: { d: 28.7, a: 645 },
            32: { d: 32.3, a: 819 },
            36: { d: 35.8, a: 1006 },
            43: { d: 43.0, a: 1452 },
            57: { d: 57.3, a: 2581 }
        };

        function calculate() {
            // 1. Get Inputs
            const fc = parseFloat(document.getElementById('fc').value);
            const fy = parseFloat(document.getElementById('fy').value);
            const lambda = parseFloat(document.getElementById('concreteType').value);
            const barKey = parseInt(document.getElementById('barSize').value);
            const numBars = parseInt(document.getElementById('numBars').value);
            const psiE = parseFloat(document.getElementById('coating').value);
            const psiT = parseFloat(document.getElementById('location').value);
            const width = parseFloat(document.getElementById('width').value);
            const cover = parseFloat(document.getElementById('cover').value);
            const ktr = parseFloat(document.getElementById('ktr').value);

            const db = barData[barKey].d;

            // 2. Determine Factors
            // Size Factor (psiS)
            // ACI 12.2.4: #19 and smaller = 0.8, larger = 1.0
            const psiS = (barKey <= 19) ? 0.8 : 1.0;

            // Check product of psiT * psiE <= 1.7
            let topCoatingProduct = psiT * psiE;
            if (topCoatingProduct > 1.7) topCoatingProduct = 1.7;

            // 3. Calculate Spacing and cb
            // cb is smaller of: distance from center of bar to nearest surface OR half center-to-center spacing
            
            // Side cover distance to center
            const cb1 = cover + (db / 2);
            
            // Calculate center-to-center spacing
            // Available width for spacing = Width - 2*Cover - db (half bar on each side)
            // Actually, usually defined as clear spacing. 
            // Total Width = 2*Cover + n*db + (n-1)*clear_spacing
            // clear_spacing = (Width - 2*Cover - n*db) / (n-1)
            // Center-to-center = clear_spacing + db
            // OR simply: (Width - 2*Cover) / (n - 1) if n > 1. 
            // If n=1, spacing is infinite/irrelevant, cb1 controls.
            
            let centerToCenter = 0;
            let clearSpacing = 0;
            let cb2 = 9999; // infinite if 1 bar

            if (numBars > 1) {
                // Width occupied by cover and bars
                const spaceForGap = width - (2 * cover) - (numBars * db);
                clearSpacing = spaceForGap / (numBars - 1);
                centerToCenter = clearSpacing + db;
                cb2 = centerToCenter / 2;
            } else {
                // For 1 bar, check width to insure it fits centered
                clearSpacing = width - (2 * cover) - db;
            }

            const cb = Math.min(cb1, cb2);

            // 4. Sanity Checks
            const sanityBox = document.getElementById('sanityCheck');
            let errorMsg = "";
            let isError = false;

            if (clearSpacing < db || clearSpacing < 25) {
                isError = true;
                errorMsg = `Spacing Issue: Clear spacing (${clearSpacing.toFixed(1)} mm) is less than bar diameter (${db} mm) or 25mm. Bars do not fit.`;
            }
            if (Math.sqrt(fc) > 8.3) {
                // ACI 12.1.2 limit
                // Just a warning, calculation continues capped
            }

            if (isError) {
                sanityBox.className = "status-box status-err";
                sanityBox.innerHTML = `<i class="fa-solid fa-triangle-exclamation"></i> <span>${errorMsg}</span>`;
                sanityBox.style.display = "flex";
            } else {
                sanityBox.className = "status-box status-ok";
                sanityBox.innerHTML = `<i class="fa-solid fa-check-circle"></i> <span>Configuration is valid. Clear Spacing: ${clearSpacing.toFixed(1)} mm</span>`;
                sanityBox.style.display = "flex";
            }

            // 5. Confinement Term
            let confinement = (cb + ktr) / db;
            if (confinement > 2.5) confinement = 2.5;

            // 6. Calculate Development Length (Ld)
            // sqrt(fc) limited to 8.3 MPa (ACI 12.1.2)
            const sqrtFc = Math.min(Math.sqrt(fc), 8.3);

            // Equation: Ld = (9/10) * (fy / (lambda * sqrtFc)) * ( (psiT * psiE * psiS) / confinement ) * db
            // Using the combined product rule for psiT*psiE
            
            // Note: The text simplifies this often, but exact formula is:
            // (3/40) * (fy / (lambda*sqrtFc)) ... This is imperial.
            // SI Equivalent ACI 318M-11 Eq 12-1: 
            // Ld = [ (9 * fy * psiT * psiE * psiS) / (10 * lambda * sqrt(fc) * ((cb+ktr)/db)) ] * db
            
            let Ld = (9 * fy * topCoatingProduct * psiS) / (10 * lambda * sqrtFc * confinement) * db;

            // Minimum length 300mm
            if (Ld < 300) Ld = 300;

            // Round up to nearest 10mm usually
            Ld = Math.ceil(Ld / 10) * 10;

            // 7. Render Output
            document.getElementById('finalResult').innerText = Ld + " mm";

            // Detailed List
            const list = document.getElementById('detailedSummary');
            list.innerHTML = `
                <div class="result-row"><span class="result-label">Mod. Factor $\\psi_t$ (Location):</span> <span class="result-value">${psiT} ${psiT > 1 ? '(Top Bar)' : '(Other)'}</span></div>
                <div class="result-row"><span class="result-label">Mod. Factor $\\psi_e$ (Coating):</span> <span class="result-value">${psiE} ${psiE > 1 ? '(Coated)' : '(Uncoated)'}</span></div>
                <div class="result-row"><span class="result-label">Mod. Factor $\\psi_s$ (Size):</span> <span class="result-value">${psiS} ${barKey <= 19 ? '(#19 or smaller)' : '(#22 or larger)'}</span></div>
                <div class="result-row"><span class="result-label">$\\lambda$ (Concrete):</span> <span class="result-value">${lambda}</span></div>
                <div class="result-row"><span class="result-label">Confinement Term $\\frac{c_b + K_{tr}}{d_b}$:</span> <span class="result-value">${confinement.toFixed(2)} ${confinement >= 2.5 ? '(Capped at 2.5)' : ''}</span></div>
                <div class="result-row"><span class="result-label">$c_b$ (Min Cover/Spacing distance):</span> <span class="result-value">${cb.toFixed(1)} mm</span></div>
                <div class="result-row"><span class="result-label">Calculated $\\ell_d$:</span> <span class="result-value">${Ld} mm</span></div>
            `;

            // Table Summary
            const schedule = document.getElementById('reinforcementSchedule');
            schedule.innerHTML = `
                <div class="result-row"><span class="result-label">Bar Diameter ($d_b$):</span><span class="result-value">${db} mm (Metric #${barKey})</span></div>
                <div class="result-row"><span class="result-label">Steel Yield ($f_y$):</span><span class="result-value">${fy} MPa</span></div>
                <div class="result-row"><span class="result-label">Concrete Strength ($f'_c$):</span><span class="result-value">${fc} MPa ($\sqrt{f'_c} = ${sqrtFc.toFixed(2)}$)</span></div>
                <div class="result-row"><span class="result-label">Provided Spacing:</span><span class="result-value">${clearSpacing.toFixed(1)} mm (Clear distance)</span></div>
                <div class="result-row"><span class="result-label">Required Embedment:</span><span class="result-value">${Ld} mm (Minimum)</span></div>
            `;

            // Visualization
            drawVisualization(width, 300, numBars, db, cover, Ld);
            
            // Re-render LaTeX
            if (window.MathJax && window.MathJax.typesetPromise) {
                MathJax.typesetPromise();
            }
        }

        function drawVisualization(beamWidth, beamHeight, nBars, db, cover, Ld) {
            const container = document.getElementById('vizContainer');
            // Scale factors to fit SVG
            const svgWidth = 500;
            const scale = svgWidth / (beamWidth + 100); // add margin
            
            const drawW = beamWidth * scale;
            const drawH = beamHeight * 0.6; // Arbitrary visual height for cross section
            const drawCover = cover * scale;
            const drawDb = db * scale;
            
            // Bar positions
            let barsSvg = '';
            // Determine X positions
            const startX = (svgWidth - drawW) / 2;
            const effectiveWidth = drawW - (2 * drawCover) - drawDb;
            
            if (nBars === 1) {
                const cx = startX + drawW/2;
                const cy = drawH - drawCover - drawDb/2;
                barsSvg += `<circle cx="${cx}" cy="${cy}" r="${drawDb/2}" class="bar-fill" />`;
            } else {
                const gap = effectiveWidth / (nBars - 1);
                for (let i = 0; i < nBars; i++) {
                    const cx = startX + drawCover + drawDb/2 + (i * gap);
                    const cy = drawH - drawCover - drawDb/2;
                    barsSvg += `<circle cx="${cx}" cy="${cy}" r="${drawDb/2}" class="bar-fill" />`;
                }
            }

            // Longitudinal View (Simple)
            const longY = drawH + 40;
            const longH = 60;
            const barLen = Math.min(300, Ld * 0.2); // Visual length scaled down
            
            const svgContent = `
                <svg viewBox="0 0 ${svgWidth} ${longY + 100}" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444" />
                        </marker>
                    </defs>
                    
                    <!-- Cross Section -->
                    <text x="${svgWidth/2}" y="20" text-anchor="middle" fill="#334155" font-size="12">Cross Section</text>
                    <rect x="${startX}" y="30" width="${drawW}" height="${drawH}" class="concrete-fill" />
                    ${barsSvg}
                    
                    <!-- Dimensions Cross Section -->
                    <line x1="${startX}" y1="${drawH + 10}" x2="${startX + drawW}" y2="${drawH + 10}" class="dim-line" />
                    <text x="${startX + drawW/2}" y="${drawH + 25}" text-anchor="middle" class="dim-text">${beamWidth} mm</text>

                    <!-- Longitudinal View -->
                    <text x="${svgWidth/2}" y="${longY}" text-anchor="middle" fill="#334155" font-size="12">Development Length</text>
                    
                    <!-- Concrete Beam Side -->
                    <rect x="50" y="${longY + 10}" width="400" height="${longH}" class="concrete-fill" />
                    
                    <!-- Bar -->
                    <rect x="50" y="${longY + 10 + longH/2 - drawDb/2}" width="350" height="${drawDb}" class="bar-fill" />
                    
                    <!-- Ld Dimension -->
                    <line x1="50" y1="${longY + 10 + longH + 15}" x2="400" y2="${longY + 10 + longH + 15}" class="dim-line" />
                    <text x="225" y="${longY + 10 + longH + 30}" text-anchor="middle" class="dim-text">Ld = ${Ld} mm</text>
                    <line x1="50" y1="${longY + 10 + longH}" x2="50" y2="${longY + 10 + longH + 20}" stroke="#94a3b8" />
                    <line x1="400" y1="${longY + 10 + longH}" x2="400" y2="${longY + 10 + longH + 20}" stroke="#94a3b8" />

                </svg>
            `;
            
            container.innerHTML = svgContent;
        }

        // Initialize with default
        window.onload = calculate;
    </script>
</body>
</html>