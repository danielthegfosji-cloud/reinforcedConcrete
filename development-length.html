<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Development Length Calculator (SI) | RC Design Suite</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <!-- MathJax for LaTeX -->
    <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        .visualization-container {
            display: flex;
            justify-content: center;
            background: #f8fafc;
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid #e2e8f0;
        }
        .viz-box { background: #f8fafc; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; display: flex; justify-content: center; border: 1px solid var(--border-color); }

        .status-box {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }
        .status-ok { background-color: #dcfce7; color: #166534; border: 1px solid #86efac; }
        .status-err { background-color: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; }

        .result-equation {
            font-size: 1.1rem;
            margin: 1.5rem 0;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 8px;
            overflow-x: auto;
        }
        /* Visualization SVG */
        svg { width: 100%; height: auto; max-width: 600px; }
        .bar-fill { fill: #334155; stroke: #334155; stroke-width: 1; }
        .concrete-fill { fill: #e2e8f0; stroke: #94a3b8; stroke-width: 2; }
        .dim-line { stroke: #3b82f6; stroke-width: 1.5; marker-end: url(#arrow-blue); marker-start: url(#arrow-blue); }
        .dim-text { fill: #3b82f6; font-size: 12px; font-weight: 600; font-family: 'Inter', sans-serif; }
        .rebar-line { fill: none; stroke: #334155; stroke-width: 4; stroke-linecap: round; }

    </style>
</head>
<body>

    <!-- SIDEBAR -->
    <nav class="sidebar">
        <a href="index.html" class="back-btn">
            <i class="fa-solid fa-arrow-left"></i> Dashboard
        </a>

        <div class="input-panel">
            <h2 class="panel-title">Development Length</h2>

        <form id="devForm">
            <!-- Material Properties -->
            <div class="section-header">Material Properties</div>
            <div class="form-row">
                <div class="form-col">
                    <label title="Concrete Compressive Strength">Concrete $f'_c$ (MPa)</label>
                    <input type="number" id="fc" value="28" min="10" step="1">
                </div>
                <div class="form-col">
                    <label title="Steel Yield Strength">Steel $f_y$ (MPa)</label>
                    <input type="number" id="fy" value="420" min="200" step="10">
                </div>
            </div>
            <div class="form-group">
                <label title="Concrete Type">Concrete Type</label>
                <select id="concreteType">
                    <option value="1.0">Normal Weight</option>
                    <option value="0.75">Lightweight</option>
                </select>
            </div>

            <!-- Reinforcement Details -->
            <div class="section-header">Reinforcement</div>
            <div class="form-row">
                <div class="form-col">
                    <label title="Bar Size (Metric)">Bar Size</label>
                    <select id="barSize">
                        <option value="10">10 mm</option>
                        <option value="13">13 mm</option>
                        <option value="16">16 mm</option>
                        <option value="19">19 mm</option>
                        <option value="22">22 mm</option>
                        <option value="25" selected>25 mm</option>
                        <option value="29">29 mm</option>
                        <option value="32">32 mm</option>
                        <option value="36">36 mm</option>
                        <option value="43">43 mm</option>
                        <option value="57">57 mm</option>
                    </select>
                </div>
                <div class="form-col">
                    <label title="Number of Bars in Layer">No. of Bars</label>
                    <input type="number" id="numBars" value="3" min="1" max="20">
                </div>
            </div>
            <div class="form-row">
                <div class="form-col">
                    <label title="Bar Coating">Coating</label>
                    <select id="coating">
                        <option value="1.0">Uncoated</option>
                        <option value="1.5">Epoxy (Cover < 3db)</option>
                        <option value="1.2">Epoxy (Other)</option>
                    </select>
                </div>
                <div class="form-col">
                    <label title="Top Bar Location">Location</label>
                    <select id="location">
                        <option value="1.0">Bottom / Vertical</option>
                        <option value="1.3">Top Bars</option>
                    </select>
                </div>
            </div>

            <!-- Geometry -->
            <div class="section-header">Section Geometry</div>
            <div class="form-row">
                <div class="form-col">
                    <label title="Beam/Element Width">Width $b$ (mm)</label>
                    <input type="number" id="width" value="300" min="100" step="10">
                </div>
                <div class="form-col">
                    <label title="Clear Cover to Bar">Clear Cover (mm)</label>
                    <input type="number" id="cover" value="40" min="10" step="5">
                </div>
            </div>
            <div class="form-group">
                <label title="Transverse Reinforcement Index">Transverse Index $K_{tr}$ (mm)</label>
                <input type="number" id="ktr" value="0" min="0" title="Usually taken as 0 for simplification">
            </div>

            <div class="section-header">Splice & Hook Details</div>
            <div class="form-group">
                <label>Splice Class</label>
                <select id="spliceClass">
                    <option value="1.0">Class A (1.0 * Ld)</option>
                    <option value="1.3" selected>Class B (1.3 * Ld)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Hook Type</label>
                <select id="hookType">
                    <option value="90">90° Hook</option>
                    <option value="180">180° Hook</option>
                </select>
            </div>
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; color: var(--sidebar-text); font-weight: 400;">
                    <input type="checkbox" id="hookCover" style="width: auto;"> Side Cover ≥ 65mm (0.7)
                </label>
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; color: var(--sidebar-text); font-weight: 400;">
                    <input type="checkbox" id="hookTies" style="width: auto;"> Enclosed in Ties (0.8)
                </label>
            </div>

            <button type="button" class="calc-btn" onclick="calculate()">
                <i class="fa-solid fa-calculator"></i> Calculate Length
            </button>
        </form>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="results-panel">
        <!-- Hero Section -->
        <div class="hero">
            <h1>Beam Bond & Development</h1>
            <p>Analyze tension development lengths ($\ell_d$), lap splices, and standard hook requirements for beam reinforcement based on ACI 318M-11.</p>
        </div>

        <!-- Status / Sanity Check -->
        <div id="sanityCheck" class="status-box status-ok" style="display:none;">
            <i class="fa-solid fa-check-circle"></i> <span>Configuration is valid.</span>
        </div>

        <svg style="display: none;">
            <defs>
                <marker id="arrow-blue" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
                    <path d="M 0 0 L 10 5 L 0 10 z" fill="#3b82f6" />
                </marker>
            </defs>
        </svg>

        <!-- Calculation Summary -->
        <div class="card">
            <h3>1. Tension Development Length ($\ell_d$)</h3>
            <div class="viz-box">
                <svg viewBox="0 0 400 150">
                    <rect x="50" y="40" width="300" height="70" class="concrete-fill" />
                    <line x1="50" y1="75" x2="300" y2="75" class="rebar-line" />
                    <line x1="50" y1="120" x2="300" y2="120" class="dim-line" />
                    <text x="175" y="140" class="dim-text" id="vizLd_val">ℓd</text>
                    
                    <!-- Cross Section Indicator -->
                    <g id="vizCrossSection" transform="translate(330, 40)">
                        <rect x="0" y="0" width="40" height="70" class="concrete-fill" />
                        <circle cx="10" cy="55" r="3" class="bar-fill" />
                        <circle cx="20" cy="55" r="3" class="bar-fill" />
                        <circle cx="30" cy="55" r="3" class="bar-fill" />
                        <text x="20" y="85" class="dim-text" style="font-size: 8px;" text-anchor="middle">Section</text>
                    </g>
                </svg>
            </div>
            
            <p style="font-size: 0.9rem; color: var(--text-sub); margin-bottom: 1rem;">Based on <strong>ACI 318M-11 (Section 12.2)</strong> / McCormac & Brown Chapter 7 (SI Units).</p>
            
            <div class="result-equation">
                $$ \ell_d = \frac{9}{10} \frac{f_y}{\lambda \sqrt{f'_c}} \frac{\psi_t \psi_e \psi_s}{\left(\frac{c_b + K_{tr}}{d_b}\right)} d_b $$
            </div>

            <div id="detailedSummary"></div>

            <div style="background-color: #f0f9ff; padding: 1rem; border-left: 4px solid #3b82f6; border-radius: 4px;">
                <span style="font-size: 1.2rem; font-weight: bold; color: var(--text-main);">Required $\ell_d$: </span>
                <span id="finalResult" style="font-size: 1.5rem; font-weight: bold; color: #2563eb;">-- mm</span>
            </div>
        </div>

        <div class="card">
            <h3>2. Tension Lap Splice</h3>
            <div class="viz-box">
                <svg viewBox="0 0 400 150">
                    <rect x="50" y="40" width="300" height="70" class="concrete-fill" />
                    <line x1="50" y1="65" x2="250" y2="65" class="rebar-line" />
                    <line x1="150" y1="85" x2="350" y2="85" class="rebar-line" />
                    <line x1="150" y1="120" x2="250" y2="120" class="dim-line" />
                    <text x="200" y="140" class="dim-text" id="vizSplice_val">Lap</text>
                </svg>
            </div>
            <div id="spliceResults"></div>
        </div>

        <div class="card">
            <h3>3. Tension Hook Development ($\ell_{dh}$)</h3>
            <div class="viz-box">
                <svg viewBox="0 0 400 200">
                    <rect x="50" y="30" width="300" height="140" class="concrete-fill" />
                    <path id="vizHookPath" d="M 320,100 L 150,100 L 150,150" class="rebar-line" style="stroke:#ef4444;" />
                    <line id="vizLdhLine" x1="150" y1="70" x2="250" y2="70" class="dim-line" />
                    <text x="180" y="60" class="dim-text" id="vizLdh_val">ℓdh</text>
                </svg>
            </div>
            <div class="result-equation">
                $$ \ell_{dh} = \max \left( \frac{0.24 \psi_e f_y d_b}{\lambda \sqrt{f'_c}}, 8d_b, 150 \text{ mm} \right) $$
            </div>
            <div id="hookResults"></div>
            <div style="margin-top: 1rem; padding: 1rem; background: #fefce8; border-radius: 8px; border: 1px solid #fef08a; font-size: 0.9rem;">
                <i class="fa-solid fa-circle-info"></i> <strong>Note:</strong> Hooks are considered ineffective for compression bars (ACI 12.5.5).
            </div>
        </div>

        <!-- Reinforcement Summary Table -->
        <div class="card">
            <h3>Reinforcement Summary</h3>
            <div id="reinforcementSchedule"></div>
        </div>

    </main>

    <!-- SCRIPT -->
    <script>
        // Metric Bar Data (Area in mm^2, Dia in mm)
        const barData = {
            10: { d: 9.5, a: 71 },
            13: { d: 12.7, a: 129 },
            16: { d: 15.9, a: 199 },
            19: { d: 19.1, a: 284 },
            22: { d: 22.2, a: 387 },
            25: { d: 25.4, a: 510 },
            29: { d: 28.7, a: 645 },
            32: { d: 32.3, a: 819 },
            36: { d: 35.8, a: 1006 },
            43: { d: 43.0, a: 1452 },
            57: { d: 57.3, a: 2581 }
        };

        function calculate() {
            // 1. Get Inputs
            const fc = parseFloat(document.getElementById('fc').value);
            const fy = parseFloat(document.getElementById('fy').value);
            const lambda = parseFloat(document.getElementById('concreteType').value);
            const barKey = parseInt(document.getElementById('barSize').value);
            const numBars = parseInt(document.getElementById('numBars').value);
            const psiE = parseFloat(document.getElementById('coating').value);
            const psiT = parseFloat(document.getElementById('location').value);
            const width = parseFloat(document.getElementById('width').value);
            const cover = parseFloat(document.getElementById('cover').value);
            const ktr = parseFloat(document.getElementById('ktr').value);

            const db = barData[barKey].d;

            // 2. Determine Factors
            // Size Factor (psiS)
            // ACI 12.2.4: #19 and smaller = 0.8, larger = 1.0
            const psiS = (barKey <= 19) ? 0.8 : 1.0;

            // Check product of psiT * psiE <= 1.7
            let topCoatingProduct = psiT * psiE;
            if (topCoatingProduct > 1.7) topCoatingProduct = 1.7;

            // 3. Calculate Spacing and cb
            // cb is smaller of: distance from center of bar to nearest surface OR half center-to-center spacing
            
            // Side cover distance to center
            const cb1 = cover + (db / 2);
            
            // Calculate center-to-center spacing
            // Available width for spacing = Width - 2*Cover - db (half bar on each side)
            // Actually, usually defined as clear spacing. 
            // Total Width = 2*Cover + n*db + (n-1)*clear_spacing
            // clear_spacing = (Width - 2*Cover - n*db) / (n-1)
            // Center-to-center = clear_spacing + db
            // OR simply: (Width - 2*Cover) / (n - 1) if n > 1. 
            // If n=1, spacing is infinite/irrelevant, cb1 controls.
            
            let centerToCenter = 0;
            let clearSpacing = 0;
            let cb2 = 9999; // infinite if 1 bar

            if (numBars > 1) {
                // Width occupied by cover and bars
                const spaceForGap = width - (2 * cover) - (numBars * db);
                clearSpacing = spaceForGap / (numBars - 1);
                centerToCenter = clearSpacing + db;
                cb2 = centerToCenter / 2;
            } else {
                // For 1 bar, check width to insure it fits centered
                clearSpacing = width - (2 * cover) - db;
            }

            const cb = Math.min(cb1, cb2);

            // 4. Sanity Checks
            const sanityBox = document.getElementById('sanityCheck');
            let errorMsg = "";
            let isError = false;

            if (clearSpacing < db || clearSpacing < 25) {
                isError = true;
                errorMsg = `Spacing Issue: Clear spacing (${clearSpacing.toFixed(1)} mm) is less than bar diameter (${db} mm) or 25mm. Bars do not fit.`;
            }
            if (Math.sqrt(fc) > 8.3) {
                // ACI 12.1.2 limit
                // Just a warning, calculation continues capped
            }

            if (isError) {
                sanityBox.className = "status-box status-err";
                sanityBox.innerHTML = `<i class="fa-solid fa-triangle-exclamation"></i> <span>${errorMsg}</span>`;
                sanityBox.style.display = "flex";
            } else {
                sanityBox.className = "status-box status-ok";
                sanityBox.innerHTML = `<i class="fa-solid fa-check-circle"></i> <span>Configuration is valid. Clear Spacing: ${clearSpacing.toFixed(1)} mm</span>`;
                sanityBox.style.display = "flex";
            }

            // 5. Confinement Term
            let confinement = (cb + ktr) / db;
            if (confinement > 2.5) confinement = 2.5;

            // 6. Calculate Development Length (Ld)
            // sqrt(fc) limited to 8.3 MPa (ACI 12.1.2)
            const sqrtFc = Math.min(Math.sqrt(fc), 8.3);

            // Equation: Ld = (9/10) * (fy / (lambda * sqrtFc)) * ( (psiT * psiE * psiS) / confinement ) * db
            // Using the combined product rule for psiT*psiE
            
            // Note: The text simplifies this often, but exact formula is:
            // (3/40) * (fy / (lambda*sqrtFc)) ... This is imperial.
            // SI Equivalent ACI 318M-11 Eq 12-1: 
            // Ld = [ (9 * fy * psiT * psiE * psiS) / (10 * lambda * sqrt(fc) * ((cb+ktr)/db)) ] * db
            
            let Ld = (9 * fy * topCoatingProduct * psiS) / (10 * lambda * sqrtFc * confinement) * db;

            // Minimum length 300mm
            if (Ld < 300) Ld = 300;

            // Round up to nearest 10mm usually
            Ld = Math.ceil(Ld / 10) * 10;

            // 7. Render Output
            document.getElementById('finalResult').innerText = Ld + " mm";

            // Detailed List
            const list = document.getElementById('detailedSummary');
            list.innerHTML = `
                <div class="result-row"><span class="result-label">Mod. Factor $\\psi_t$ (Location):</span> <span class="result-value">${psiT} ${psiT > 1 ? '(Top Bar)' : '(Other)'}</span></div>
                <div class="result-row"><span class="result-label">Mod. Factor $\\psi_e$ (Coating):</span> <span class="result-value">${psiE} ${psiE > 1 ? '(Coated)' : '(Uncoated)'}</span></div>
                <div class="result-row"><span class="result-label">Mod. Factor $\\psi_s$ (Size):</span> <span class="result-value">${psiS} ${barKey <= 19 ? '(#19 or smaller)' : '(#22 or larger)'}</span></div>
                <div class="result-row"><span class="result-label">$\\lambda$ (Concrete):</span> <span class="result-value">${lambda}</span></div>
                <div class="result-row"><span class="result-label">Confinement Term $\\frac{c_b + K_{tr}}{d_b}$:</span> <span class="result-value">${confinement.toFixed(2)} ${confinement >= 2.5 ? '(Capped at 2.5)' : ''}</span></div>
                <div class="result-row"><span class="result-label">$c_b$ (Min Cover/Spacing distance):</span> <span class="result-value">${cb.toFixed(1)} mm</span></div>
                <div class="result-row"><span class="result-label">Calculated $\\ell_d$:</span> <span class="result-value">${Ld} mm</span></div>
            `;

            // Table Summary
            const schedule = document.getElementById('reinforcementSchedule');
            schedule.innerHTML = `
                <div class="result-row"><span class="result-label">Bar Diameter ($d_b$):</span><span class="result-value">${db} mm (Metric #${barKey})</span></div>
                <div class="result-row"><span class="result-label">Steel Yield ($f_y$):</span><span class="result-value">${fy} MPa</span></div>
                <div class="result-row"><span class="result-label">Concrete Strength ($f'_c$):</span><span class="result-value">${fc} MPa ($\sqrt{f'_c} = ${sqrtFc.toFixed(2)}$)</span></div>
                <div class="result-row"><span class="result-label">Provided Spacing:</span><span class="result-value">${clearSpacing.toFixed(1)} mm (Clear distance)</span></div>
                <div class="result-row"><span class="result-label">Required Embedment:</span><span class="result-value">${Ld} mm (Minimum)</span></div>
            `;

            // --- 8. Lap Splice ---
            const spliceClass = parseFloat(document.getElementById('spliceClass').value);
            let Lsplice = Ld * spliceClass;
            if (Lsplice < 300) Lsplice = 300;
            Lsplice = Math.ceil(Lsplice / 10) * 10;

            document.getElementById('spliceResults').innerHTML = `
                <p>Class ${spliceClass === 1.0 ? 'A' : 'B'} Splice: $${spliceClass} \\times \\ell_d = ${Lsplice}$ mm</p>
                <p><strong>Required Lap Length = ${Lsplice} mm</strong></p>
            `;

            // --- 9. Hook Development ---
            const hookTypeVal = document.getElementById('hookType').value;
            const psiE_hook = psiE > 1.0 ? 1.2 : 1.0;
            let Ldh = (0.24 * psiE_hook * fy * db) / (lambda * sqrtFc);
            
            let hookFactors = 1.0;
            if (document.getElementById('hookCover').checked) hookFactors *= 0.7;
            if (document.getElementById('hookTies').checked) hookFactors *= 0.8;
            Ldh *= hookFactors;

            const min_ldh = Math.max(150, 8 * db);
            if (Ldh < min_ldh) Ldh = min_ldh;
            Ldh = Math.ceil(Ldh / 10) * 10;

            const extension = (hookTypeVal === '90') ? (12 * db) : Math.max(4 * db, 65);

            document.getElementById('hookResults').innerHTML = `
                <p>Calculated $\ell_{dh}$: ${Ldh} mm</p>
                <ul>
                    <li>Extension Length ($L_{ext}$): <strong>${Math.ceil(extension)} mm</strong></li>
                    <li>Modification Factors: ${hookFactors.toFixed(2)}</li>
                </ul>
                <p><strong>Required Hook Development $\ell_{dh} = ${Ldh} mm</strong></p>
            `;

            // --- 10. Update Visuals ---
            document.getElementById('vizLd_val').textContent = `ℓd = ${Ld}mm`;
            document.getElementById('vizSplice_val').textContent = `Lap = ${Lsplice}mm`;
            document.getElementById('vizLdh_val').textContent = `ℓdh = ${Ldh}mm`;

            const vizHookPath = document.getElementById('vizHookPath');
            const vizLdhLine = document.getElementById('vizLdhLine');
            if (hookTypeVal === '90') {
                vizHookPath.setAttribute('d', "M 320,100 L 150,100 L 150,150");
                vizLdhLine.setAttribute('x1', "150");
                vizLdhLine.setAttribute('x2', "250");
            } else {
                vizHookPath.setAttribute('d', "M 320,100 L 150,100 A 20 20 0 0 0 150,140 L 180,140");
                vizLdhLine.setAttribute('x1', "130");
                vizLdhLine.setAttribute('x2', "230");
            }
            
            // Re-render LaTeX
            if (window.MathJax && window.MathJax.typesetPromise) {
                MathJax.typesetPromise();
            }
        }
        // Initialize with default
        window.onload = function() {
            // Attach listeners to all inputs for live update
            document.querySelectorAll('.input-panel input, .input-panel select').forEach(el => {
                el.addEventListener('input', calculate);
            });
            calculate();
        };
    </script>
</body>
</html>